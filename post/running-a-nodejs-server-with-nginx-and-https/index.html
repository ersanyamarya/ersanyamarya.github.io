<!DOCTYPE html><html><head><meta charSet="utf-8" class="next-head"/><meta name="viewport" content="initial-scale=1.0, width=device-width" class="next-head"/><meta name="keywords" content="NginX,HTTPS,SSL,TSL,NodeJS" class="next-head"/><title class="next-head">Running a NodeJS server with NginX and HTTPS</title><meta name="description" content="Many time Nodejs/Express web developers or MEAN stack developers feel very inconvenient when it comes to deploying their app or services on a server. To run a server on a remote machine and to access it without the hassle of adding colons (:) with the port number requires a certain different approach. Another problem that arises is how to set up an https server." class="next-head"/><meta itemProp="name" content="Running a NodeJS server with NginX and HTTPS" class="next-head"/><meta itemProp="description" content="Many time Nodejs/Express web developers or MEAN stack developers feel very inconvenient when it comes to deploying their app or services on a server. To run a server on a remote machine and to access it without the hassle of adding colons (:) with the port number requires a certain different approach. Another problem that arises is how to set up an https server." class="next-head"/><meta itemProp="image" content="https://images.ctfassets.net/d7k4z456z5gd/L4Y72rzuo54adj9PPhhZV/f740819e7e21cfdae3d46036dae50fea/nginx.png" class="next-head"/><meta name="twitter:card" content="summary_large_image" class="next-head"/><meta name="twitter:title" content="Running a NodeJS server with NginX and HTTPS" class="next-head"/><meta name="twitter:description" content="For MEAN stack developers deploying their app on a server. Access it without the hassle of adding port number with https." class="next-head"/><meta name="twitter:creator" content="@sanyamarya" class="next-head"/><meta name="twitter:image:src" content="https://images.ctfassets.net/d7k4z456z5gd/L4Y72rzuo54adj9PPhhZV/f740819e7e21cfdae3d46036dae50fea/nginx.png" class="next-head"/><meta property="og:title" content="Running a NodeJS server with NginX and HTTPS" class="next-head"/><meta property="og:type" content="article" class="next-head"/><meta property="og:url" content="sanyamarya.io/post?slug=running-a-nodejs-server-with-nginx-and-https" class="next-head"/><meta property="og:image" content="https://images.ctfassets.net/d7k4z456z5gd/L4Y72rzuo54adj9PPhhZV/f740819e7e21cfdae3d46036dae50fea/nginx.png" class="next-head"/><meta property="og:description" content="Many time Nodejs/Express web developers or MEAN stack developers feel very inconvenient when it comes to deploying their app or services on a server. To run a server on a remote machine and to access it without the hassle of adding colons (:) with the port number requires a certain different approach. Another problem that arises is how to set up an https server." class="next-head"/><meta property="og:site_name" content="sanyamarya" class="next-head"/><meta property="article:published_time" content="2019-04-01T00:00+05:30" class="next-head"/><meta property="article:section" content="Technology,Exemplar" class="next-head"/><meta property="article:tag" content="NginX HTTPS SSL TSL NodeJS" class="next-head"/><link rel="icon" href="demo_icon.gif" type="image/gif" sizes="16x16" class="next-head"/><link rel="preload" href="/test-nextjs-app/_next/static/lDQt2CdsNCHIpIFVwcXco/pages/post.js" as="script"/><link rel="preload" href="/test-nextjs-app/_next/static/lDQt2CdsNCHIpIFVwcXco/pages/_app.js" as="script"/><link rel="preload" href="/test-nextjs-app/_next/static/runtime/webpack-838b392324e3598684b5.js" as="script"/><link rel="preload" href="/test-nextjs-app/_next/static/chunks/commons.cb36c8c40356dc4c0477.js" as="script"/><link rel="preload" href="/test-nextjs-app/_next/static/chunks/styles.d6e8128a2aa91aff967f.js" as="script"/><link rel="preload" href="/test-nextjs-app/_next/static/runtime/main-25cffaf85056c2eff49e.js" as="script"/><link rel="stylesheet" href="/test-nextjs-app/_next/static/css/commons.66292daa.chunk.css"/><link rel="stylesheet" href="/test-nextjs-app/_next/static/css/styles.e679b755.chunk.css"/></head><body><div id="__next"><div><header><a class="nav-link active" href="/"><span>Home</span><i class="fas fa-undefined"></i></a><a class="nav-link" href="/about/"><span>About</span><i class="fas fa-undefined"></i></a><a class="nav-link" href="/blog/"><span>Blog</span><i class="fas fa-undefined"></i></a></header><img src="//images.ctfassets.net/d7k4z456z5gd/L4Y72rzuo54adj9PPhhZV/f740819e7e21cfdae3d46036dae50fea/nginx.png" alt="nginx.png"/><h1>Running a NodeJS server with NginX and HTTPS</h1></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"item":{"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"d7k4z456z5gd"}},"id":"56UIktBjpMx3AqS01OwYYN","type":"Entry","createdAt":"2019-04-01T16:02:01.242Z","updatedAt":"2019-04-01T16:02:01.242Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"post"}},"locale":"en-US"},"fields":{"title":"Running a NodeJS server with NginX and HTTPS","slug":"running-a-nodejs-server-with-nginx-and-https","content":"Many time **Nodejs/Express** web developers or **MEAN stack** developers feel very inconvenient when it comes to deploying their app or services on a server. To run a server on a remote machine and to access it without the hassle of adding colons (:) with the port number requires a certain different approach. Another problem that arises is how to set up an https server.\n\nYou don't want your users to add a port number everytime they want to visit your web application even though when you have a domain name. Also, no one wants to visit a website or web application which doesn't run on an HTTPS server *( \"it is not secure\" )*.\n\n\u003c!--more--\u003e\n\nSo, **how to take http\u0026#058;//192.168.1.2:8080 to just http\u0026#058;//192.168.1.2 ( without using the port number/running on default HTTP port 80 ) and https\u0026#058;//192.168.1.2 ( running it on HTTPS/default port 443)?**\n\nYou might have tried listening to the default ports in your express app and failed. This is because of the error code EACCES, which means you don't have proper permissions to run applications on that port. On Linux systems, any port below 1024 requires root access.\n*However, you can run your server on Port 80 if you are a sudoer on the system. But, what about the HTTPS server?*\n\nSo, let some other applications take all that trouble for you and you contemplate on the functionality, look and feel of your app. \n\n\u003e \"Do one thing, and do it well\". \n\n**There are many options for achieving it. But I prefer NginX.**\n\n![NginX](https\u0026#058;//theexuberantindian.files.wordpress.com/2018/05/nginx.png \"NginX\")\n\n\n## Nginx\n\nNginx is a high-performance HTTP server as well as a reverse proxy. Unlike traditional servers, Nginx follows an event-driven asynchronous architecture. As a result, the memory footprint is low and performance is high. If you are running a NodeJs based web app you should seriously consider using Nginx as a reverse proxy. Nginx can be very efficient in serving static assets. For all other requests, it will talk to your NodeJs backend and send the response to the client. \n\nIn this tutorial, we will discuss how to configure Nginx to work with NodeJs. We will also see how to setup SSL in the Nginx server.\n\n## What do we need?\n\n1. A running Node + Express server\n1. NginX\n1. OpenSSL\n\n\n### Step 1: **Create the SSL Certificate using OpenSSL**\n\n#### For starters, let us understand what is TSL and SSL\n\n* TLS, or transport layer security, and its predecessor SSL, which stands for secure sockets layer, are web protocols used to wrap normal traffic in a protected, encrypted wrapper.\n\n* Using this technology, servers can send traffic safely between the server and clients without the possibility of the messages being intercepted by outside parties. The certificate system also assists users in verifying the identity of the sites that they are connecting with.\n\n* TLS/SSL works by using a combination of a public certificate and a private key. The SSL key is kept a secret on the server. It is used to encrypt content sent to clients. The SSL certificate is publicly shared with anyone requesting the content. It can be used to decrypt the content signed by the associated SSL key.\n\n#### We can create a self-signed key and certificate pair with OpenSSL in a single command:\n\n```bash\n$ sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/selfsigned.key -out /etc/ssl/selfsigned.crt\n```\n\n* **openssl:** This is the basic command line tool for creating and managing OpenSSL certificates, keys, and other files.\n* **req:** This subcommand specifies that we want to use X.509 certificate signing request (CSR) management. The \"X.509\" is a public key infrastructure standard that SSL and TLS adhere to for its key and certificate management. We want to create a new X.509 cert, so we are using this subcommand.\n* **-x509:** This further modifies the previous subcommand by telling the utility that we want to make a self-signed certificate instead of generating a certificate signing request, as would normally happen.\n* **-nodes:** This tells OpenSSL to skip the option to secure our certificate with a passphrase. We need NginX to be able to read the file, without user intervention, when the server starts up. A passphrase would prevent this from happening because we would have to enter it after every restart.\n* **-days 365:** This option sets the length of time that the certificate will be considered valid. We set it for one year here.\n* **-newkey rsa:2048:** This specifies that we want to generate a new certificate and a new key at the same time. We did not create the key that is required to sign the certificate in a previous step, so we need to create it along with the certificate. The rsa:2048 portion tells it to make an RSA key that is 2048 bits long.\n* **-keyout:** This line tells OpenSSL where to place the generated private key file that we are creating.\n* **-out:** This tells OpenSSL where to place the certificate that we are creating.\n\nAs I stated above, these options will create both a key file and a certificate. We will be asked a few questions about our server in order to embed the information correctly in the certificate.\n\n```bash\nOutput\nCountry Name (2 letter code) [AU]:IN\nState or Province Name (full name) [Some-State]:Bihar\nLocality Name (eg, city) []:Patna\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:My Company\nOrganizational Unit Name (eg, section) []:R and D\nCommon Name (e.g. server FQDN or YOUR name) []:server_IP_address\nEmail Address []:admin@your_domain.com\n```\n\nBoth of the files we created will be placed in the appropriate subdirectories of the /etc/ssl directory.\n\n\n### Step 2: **Installing NginX Server**\n\n#### Installation on Mac\n\n* If you are on Mac you can use Homebrew to install Nginx easily. The steps are as following:\n* Homebrew needs the directory /usr/local to be chown‘d to your username. So, run the following command in the terminal first:\n\n```bash\n$ sudo chown -R 'username here' /usr/local\n```\n\n* Now the following two commands will install Nginx on your system.\n\n```bash\n$ brew link pcre\n$ brew install nginx\n```\n\n* Once the installation is complete you can type the following command to start Nginx:\n\n```bash\n$ sudo nginx\n```\n\n* The Nginx config file can be found here: /usr/local/etc/nginx/nginx.conf.\n\n#### Installation on Ubuntu\n\n* If you are running Ubuntu you can use the following command to install Nginx:\n\n```bash\n$ sudo apt-get update\n$ sudo apt-get install nginx\n```\n\nOnce Nginx is installed it will start automatically.\n\n#### Installation on Windows\n\n* For Windows, head over to the Nginx downloads page and get the zip. The next step is unzipping the archive and moving to the directory in the command prompt as follows:\n\n```bash\n$ unzip nginx-1.3.13.zip\n$ cd nginx-1.3.13\n$ start nginx\n```\n\n* As you can see the command start nginx will start Nginx.\n\n* Now that the installation is done, let’s see how you can configure a simple server. \n\n### Step 3: **Running the Node Server**\n\n* You must have writen something like the below in your app.js/index.js file \n```js\nconst port = 3000;\napp.listen(port, () =\u003e {\n    console.log('Server started on port ' + port);\n});\n```\n* Which means: The server will run on port 3000.\n\nuse `node app.js` to start the server which shows some message on the console.\n```bash\nServer started on port 80\n```\n\n* When you go to http\u0026#058;//localhost:3000 you can see your server running. Or you can test your APIs using some application like POSTMAN with http\u0026#058;//localhost:3000/api/apiEndpoint\n\n* Now, when we have generated the key and certificate for TSL/SSL, installed NginX and started our Node-Express app, let's configure the NginX server.\n\n### Step 4: **Configure NginX Server for HTTP**\n* Next, we will configure the server block to suit our needs. We want to serve static files from our website with the help of Nginx and pass all other requests to our Node.js backend.\n* So, go edit the default file in the `sites-available` folder and replace the server block with a new block as shown below:\n\n```\n$ cd /etc/nginx/sites-available\n$ sudo nano default\n```\n\n```bash\nserver {\n    listen  80;\n    server_name localhost;\n    \n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n\t\n}\n```\n\n* As you can see our Nginx server listens on http\u0026#058;//localhost *(http\u0026#058;//localhost:80 - 80 is the default port for HTTP so, need to specfy)*. The **location /** block tells Nginx what to do when any request comes at the root of the URL. Inside the location block, we use proxy_pass to point to the NodeJs backend which is http\u0026#058;//localhost:3000 in our case. \n\n* At this point, you should save the file and type the following to restart Nginx:\n\n#### Mac:\n```bash\n$ sudo nginx -s stop \u0026\u0026 sudo nginx\n```\n#### Ubuntu:\n```bash\nsudo service nginx restart\n```\nOr\n```bash\nsudo /etc/init.d/nginx restart\n```\n#### Windows:\n```bash\nnginx -s reload\n```\n\n### Step 5: **Configure NginX Server for HTTPS** \n\n* On a production website many times you will need to configure SSL to protect sensitive information. Usually, you will go to a CA (Certificate Authority) and get a certificate issued. We have created a self-signed certificate. The only problem is that browsers will show a warning that the *“Certificate is not Trusted”* when someone visits your website. But for testing on the local machine that’s perfectly fine.\n\n* Once you have the certificate and a private key you can set up SSL in Nginx. You need to modify our previous server block to the following:\n\n\n\n```bash\nserver {\n\n    listen  443 ssl;\n    \n    server_name localhost;\n    ssl_certificate  /etc/ssl/selfsigned.crt;\n    ssl_certificate_key /etc/ssl/selfsigned.key;\n\n    listen  80;\n        server_name localhost;\n    \n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n\t\n}\n```\n\n* **At this point you should save the file and restart Nginx.**\n\n\n* That’s it! Now if you access https\u0026#058;//localhost/ *(https\u0026#058;//localhost:443 - 443 is the default port for HTTPS so, need to specfy)* your SSL set up will work. Here we assume that the certificate file and private key are located at **/etc/ssl/selfsigned.crt** and **/etc/ssl/selfsigned.key** respectively. You can change these locations if you want.\n\n\n[![logosmallestd](https://user-images.githubusercontent.com/28115284/28752842-881291c0-7546-11e7-9277-bd89186ca933.png)](https://medium.com/@er.sanyam.arya)\n\n***\n\n\n## What is Reverse Proxy\nIn computer networks, a **reverse proxy** is a type of proxy server that retrieves resources on behalf of a client from one or more servers. These resources are then returned to the client as if they originated from the Web server itself.\nUnlike a forward proxy, which is an intermediary for its associated clients to contact any server, a reverse proxy is an intermediary for its associated servers to be contacted by any client.\n\nQuite often, popular web servers use reverse-proxying functionality, shielding application frameworks of weaker HTTP capabilities\n\n","keywords":["NginX","HTTPS","SSL","TSL","NodeJS"],"description":"Many time Nodejs/Express web developers or MEAN stack developers feel very inconvenient when it comes to deploying their app or services on a server. To run a server on a remote machine and to access it without the hassle of adding colons (:) with the port number requires a certain different approach. Another problem that arises is how to set up an https server.","twitterDescription":"For MEAN stack developers deploying their app on a server. Access it without the hassle of adding port number with https.","featuredImage":{"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"d7k4z456z5gd"}},"id":"L4Y72rzuo54adj9PPhhZV","type":"Asset","createdAt":"2019-04-01T16:00:46.021Z","updatedAt":"2019-04-01T16:00:46.021Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":1,"locale":"en-US"},"fields":{"title":"nginx","description":"Featured Image for Nginx blog post","file":{"url":"//images.ctfassets.net/d7k4z456z5gd/L4Y72rzuo54adj9PPhhZV/f740819e7e21cfdae3d46036dae50fea/nginx.png","details":{"size":92513,"image":{"width":802,"height":273}},"fileName":"nginx.png","contentType":"image/png"}}},"category":["Technology","Exemplar"],"publishedOn":"2019-04-01T00:00+05:30"}}}},"page":"/post","query":{"slug":"running-a-nodejs-server-with-nginx-and-https"},"buildId":"lDQt2CdsNCHIpIFVwcXco","assetPrefix":"/test-nextjs-app","nextExport":true}</script><script async="" id="__NEXT_PAGE__/post" src="/test-nextjs-app/_next/static/lDQt2CdsNCHIpIFVwcXco/pages/post.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/test-nextjs-app/_next/static/lDQt2CdsNCHIpIFVwcXco/pages/_app.js"></script><script src="/test-nextjs-app/_next/static/runtime/webpack-838b392324e3598684b5.js" async=""></script><script src="/test-nextjs-app/_next/static/chunks/commons.cb36c8c40356dc4c0477.js" async=""></script><script src="/test-nextjs-app/_next/static/chunks/styles.d6e8128a2aa91aff967f.js" async=""></script><script src="/test-nextjs-app/_next/static/runtime/main-25cffaf85056c2eff49e.js" async=""></script></body></html>